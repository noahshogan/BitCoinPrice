<html ng-app="myApp" ng-controller="myCtrl">
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
<head>
    <link rel="shortcut icon" type="image/x-icon" href="bitcoin-icon.png" />
    <title>{{averageOfAll}}$</title>
</head>
<body>
    <h1>BitStamp Price: {{bitSteampPrice}}$</h1>
    <h1>BitFinex &nbsp Price: {{bitFinexPrice}}$</h1>
    <h1>CoinBase Price: {{coinBasePrice}}$</h1>
    <h1>CoinDesk Price: {{coinDeskPrice}}$</h1>
    <br><br><br><br><br>
    <h1>minPrice : {{minPrice}}$ &nbsp&nbsp&nbsp  maxPrice : {{maxPrice}}$</h1>

<script>
    var app = angular.module('myApp', []);
    var bitSteampPrice;
    var bitFinexPrice;
    var coinBasePrice;
    var average;
    var coinDeskPrice;
    var maxPrice=0;
    var minPrice=9999999999;
    var queue = [];
    app.controller('myCtrl', function($scope, $http,$rootScope) {
        function fn60sec() {
        $http.get("https://www.bitstamp.net/api/v2/transactions/btcusd/")
            .then(function(response) {
                var total=response.data.reduce(function (acc, obj){ return acc + parseInt(obj.price);}, 0);
                bitSteampPrice=Math.round(total/response.data.length);
                $scope.bitSteampPrice=bitSteampPrice;
            }).then(
            $http.get("https://api.bitfinex.com/v2/trades/tBTCUSD/hist")
                .then(function(response) {
                    var total=response.data.reduce(function (acc, obj){ return acc + parseInt(obj[3]);}, 0);
                    bitFinexPrice=Math.round(total/response.data.length);
                    $scope.bitFinexPrice=bitFinexPrice;
                })
        ).then(
            $http.get("https://api.coinbase.com/v2/prices/BTC-USD/spot")
                .then(function(response) {
                    coinBasePrice=Math.round(response.data.data.amount);
                    $scope.coinBasePrice=coinBasePrice;
                })
        ).then(
                $http.get("https://api.coindesk.com/v1/bpi/currentprice.json")
                    .then(function(response) {
                        coinDeskPrice=Math.round(response.data.bpi.USD.rate_float);
                        $scope.coinDeskPrice=coinDeskPrice;
                    })
            ).then(
            average= Math.round((bitFinexPrice+bitSteampPrice+coinBasePrice+coinDeskPrice)/4)

        )
            $rootScope.averageOfAll=average;
        addToMaxMix(average)
    }
        fn60sec();
        setInterval(fn60sec, 10000);
        function addToMaxMix(number){
            queue.push(number);
            if(queue.length>360){
                queue.shift();
            }
            for(var i = 0 ; i < queue.length ; i++){
                if(queue[i]<minPrice) minPrice=queue[i];
                if(queue[i]>maxPrice) maxPrice=queue[i];
            }
            $scope.minPrice=minPrice;
            $scope.maxPrice=maxPrice;
        }
    });


</script>
</body>
</html>
